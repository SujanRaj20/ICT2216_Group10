{% include "seller-templates/seller-navbar.html" %}
{% block title %}Add Listing{% endblock %}

<!-- Bootstrap CSS -->
<!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> -->

<!-- Bootstrap JS and dependencies (Popper.js) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="5000">
      <div class="toast-header">
        <strong class="mr-auto">Success</strong>
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="toast-body">
        Listing added successfully
      </div>
    </div>
  </div>
  


<div class="container-fluid page-header py-4">
    <h1 class="text-center text-white display-6">Add Listing</h1>
</div>

<div class="container-fluid testimonial py-1">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-7">
                <div class="bg-light rounded p-4">
                    <form id="addListingForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="keywords" class="form-label">Keywords (seperate with commas)</label>
                            <input type="text" class="form-control" id="keywords">
                        </div>
                        <div class="mb-3">
                            <label for="release_date" class="form-label">Release Date</label>
                            <input type="date" class="form-control" id="release_date">
                        </div>
                        <div class="mb-3">
                            <label for="author" class="form-label">Author</label>
                            <input type="text" class="form-control" id="author">
                        </div>
                        <div class="mb-3">
                            <label for="publisher" class="form-label">Publisher</label>
                            <input type="text" class="form-control" id="publisher">
                        </div>
                        <div class="mb-3">
                            <label for="price" class="form-label">Price</label>
                            <input type="number" step="0.01" class="form-control" id="price" required>
                        </div>
                        <div class="mb-3">
                            <label for="stock" class="form-label">Stock</label>
                            <input type="number" class="form-control" id="stock" required>
                        </div>
                        <div class="mb-3">
                            <label for="type" class="form-label">Type</label>
                            <select class="form-select" id="type" required>
                                <option value="Children">Children</option>
                                <option value="Autobiography">Autobiography</option>
                                <option value="Textbook">Textbook</option>
                                <option value="Fantasy">Fantasy</option>
                                <option value="Sci-fi">Sci-fi</option>
                                <option value="Poetry">Poetry</option>
                                <option value="Cookbook">Cookbook</option>
                                <option value="History">History</option>
                                <option value="Romance">Romance</option>
                                <option value="Horror">Horror</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="image" class="form-label">Image</label>
                            <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
                        </div>
                        <div class="mb-3">
                            <button type="submit" class="btn btn-primary w-100">Add Listing</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('addListingForm').addEventListener('submit', function(event) {
        event.preventDefault();
    
        // Declare formData at the beginning
        const formData = new FormData();
    
        // Continue with appending form data values
        const title = sanitize(document.getElementById('title').value);
        const description = sanitize(document.getElementById('description').value);
        const keywords = sanitize(document.getElementById('keywords').value);
        const release_date = document.getElementById('release_date').value;
        const author = sanitize(document.getElementById('author').value);
        const publisher = sanitize(document.getElementById('publisher').value);
        const price = sanitize(document.getElementById('price').value);
        const stock = sanitize(document.getElementById('stock').value);
        const type = sanitize(document.getElementById('type').value);
        const image = document.getElementById('image').files[0];
    
        formData.append('title', title);
        formData.append('description', description);
        formData.append('keywords', keywords);
        formData.append('release_date', release_date);
        formData.append('author', author);
        formData.append('publisher', publisher);
        formData.append('price', price);
        formData.append('stock', stock);
        formData.append('type', type);
        formData.append('image', image);
    
        // Continue with fetch request using formData
        fetch('/add-listing', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); // Check response data in console
            if (data.message === "Listing added successfully") {
                $('.toast').toast('show'); // Show the toast if message matches
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });

    function sanitize(input) {
        const element = document.createElement('div');
        element.innerText = input;
        return element.innerHTML;
    }
</script>


{% include "seller-templates/seller-footer.html" %}