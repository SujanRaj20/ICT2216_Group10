<style>
    .align-left-div {
        text-align: left;
        /* Ensure text is aligned to the left */
        padding-left: 5%;
    }
</style>
{% include "admin-navbar.html" %}
<div class="container-fluid page-header py-4" style="margin-top: 10px;">
    <h1 class="text-center text-white display-6">Comments List</h1>
</div>
<div class="container-fluid py-2">
    <div class="container py-5">
        {% for comment in comments %}
        <div class="comment-container align-left-div" style="width: 100%; padding: 1%;">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Title</th>
                        <th scope="col">Body</th>
                        <th scope="col">Rating</th>
                        <th scope="col">Created At</th>
                        <th scope="col">User</th>
                        <th scope="col">Listing</th>
                        <th scope="col">Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                    <td>
                        <p class="mb-0 mt-4">{{ comment.comment_id }}</p>
                    </td>
                    <td>
                        <p class="mb-0 mt-4">{{ comment.comment_title }}</p>
                    </td>
                    <td>
                        <p class="mb-0 mt-4">{{ comment.comment_body }}</p>
                    </td>
                    <td>
                        <p class="mb-0 mt-4">{{ comment.comment_rating }}</p>
                    </td>
                    <td>
                        <p class="mb-0 mt-4">{{ comment.comment_created_at }}</p>
                    </td>
                    <td>
                        <button class="btn btn-success mt-3" onclick="toggleUserPanel('{{ comment.comment_id }}')">User</button>
                    </td>
                    <td>
                        <button class="btn btn-success mt-3" onclick="toggleListingPanel('{{ comment.listing_id }}')">Listing</button>
                    </td>
                    <td>
                        <button
                class="btn btn-md rounded-circle bg-light border mt-4" onclick="confirmDelete('{{comment.comment_id}}')">
                <i class="fa fa-trash text-danger"></i>
              </button>
                    </td>
                </tr>
                </tbody>
            </table>
            <div id="userPanel_{{ comment.comment_id }}" style="display: none; margin-top:3%">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">User ID</th>
                            <th scope="col">Name</th>
                            <th scope="col">Username</th>
                            <th scope="col">Email</th>
                            <th scope="col">Phone Number At</th>
                            <th scope="col">Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.user_id }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.user_fname }} {{ comment.user_lname }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.user_username }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.user_email }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.user_phone_num }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.user_role }}</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="listingPanel_{{ comment.listing_id }}" style="display: none; margin-top:3%">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Image</th>
                            <th scope="col">Listing ID</th>
                            <th scope="col">Title</th>
                            <th scope="col">Description</th>
                            <th scope="col">Keywords</th>
                            <th scope="col">Release Date</th>
                            <th scope="col">Author</th>
                            <th scope="col">Publisher</th>
                            <th scope="col">Price</th>
                            <th scope="col">Stock</th>
                            <th scope="col">Type</th>
                            <th scope="col">Seller ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <th scope="row">
                            <div class="d-flex align-items-center">
                              <img
                                src="{{ comment.listing_imagepath[4:] }}"
                                class="img-fluid me-5 rounded-circle"
                                style="width: 80px; height: 80px"
                                alt=""
                              />
                            </div>
                          </th>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_id }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_title }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_description }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_keywords }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_release_date }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_author }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_publisher }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_price }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_stock }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_type }}</p>
                        </td>
                        <td>
                            <p class="mb-0 mt-4">{{ comment.listing_seller_id }}</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    function toggleUserPanel(itemId) {
        var reportForm = document.getElementById(`userPanel_${itemId}`);
        if (reportForm.style.display === "none") {
            reportForm.style.display = "block";
        } else {
            reportForm.style.display = "none";
        }
    }

    function toggleListingPanel(itemId) {
        var reportForm = document.getElementById(`listingPanel_${itemId}`);
        if (reportForm.style.display === "none") {
            reportForm.style.display = "block";
        } else {
            reportForm.style.display = "none";
        }
    }

    function confirmDelete(listingId) {
        if (confirm("Are you sure you want to delete this comment?")) {
            deleteItem(listingId);
        }
    }

    function deleteItem(listingId) {
        $.ajax({
            url: `/admin/commentdelete/${listingId}`,
            type: "POST",
            success: function (response) {
                window.location.reload();
            },
            error: function (xhr) {
                alert("An error occurred while deleting the item.");
            },
        });
    }
</script>

{% include "admin-footer.html" %}