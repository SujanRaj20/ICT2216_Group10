{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
    <!-- Single Page Header start -->
    <div class="container-fluid page-header py-4">
        <h1 class="text-center text-white display-6">Buyer Login</h1>
    </div>
    <!-- Single Page Header End -->
<!-- Log In Start -->
<div class="container-fluid testimonial py-1">
    <div class="container py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="bg-light rounded p-4">
                        <form id="loginForm" method="POST" action="/buyerlogin">
                            <!-- Input fields for email and password -->
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <div class="mb-3">
                                <button type="submit" class="btn btn-primary w-100">Login</button>
                            </div>
                            <div class="mb-3">
                                <a href="{{ url_for('main.signup') }}" class="nav-item nav-link">No account? Sign up here</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Testimonial End -->
<script>
    document.getElementById('loginForm').addEventListener('submit', function(event) {
        event.preventDefault();  // Prevent default form submission

        // Get form data
        const formData = new FormData(event.target);

        // Send POST request to Flask endpoint
        fetch('{{ url_for("user.login") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Check response for success or error
            if (data.message) {
                // Redirect to main page or handle successful login
                window.location.href = '{{ url_for("main.index") }}';
            } else if (data.error) {
                // Display error using JavaScript alert
                alert(data.error);
            } else {
                // Handle unexpected response
                alert('Unexpected response from server');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Invalid username or password');
        });
    });
</script>

{% endblock %}